# Multi-Vendor (Multi-Store) POS System - Pure PHP + MySQL Design

This document outlines the design for a multi-vendor Point of Sale (POS) system built in pure PHP + MySQL, without frameworks. The system supports multiple organizations, each with multiple stores, ensuring strong data isolation and scalability. Optimized for tablet installations and mobile super-admin usage. Mobile-first design with low resource consumption.

## 1. Arquitectura Mobile-First Multi-Tienda

### Backend Architecture
- **PHP Server-Side Rendering (SSR)**: All pages rendered on server to minimize client-side JS. No heavy SPA frameworks.
- **MVC-Like Structure**: Models for DB, Controllers for logic, Views as PHP templates.
- **Database**: MySQL with PDO, singleton connection. Tables with store_id for isolation.
- **Routing**: Simple array-based routing in index.php, no complex routers.
- **Session Management**: PHP sessions with file storage, optimized for tablets (long sessions).

### Frontend Architecture (No SPA Pesada)
- **Server-Side Rendering**: HTML generated by PHP, minimal JS for interactions.
- **CSS Native**: No frameworks, custom CSS with mobile-first responsive design.
- **JS Vanilla**: Micro-scripts loaded on demand, no bundles >50KB.
- **Progressive Enhancement**: Core functionality works without JS.

### Flujo de NavegaciÃ³n Optimizado para TÃ¡ctil
- **Bottom Navigation**: Thumb-friendly buttons at bottom for tablets.
- **Swipe Gestures**: Horizontal swipes for product categories, vertical for lists.
- **Large Touch Targets**: Min 44px buttons, 1rem font size.
- **Short Flows**: Max 3 steps per action (e.g., Add Product: Select Category â†’ Enter Details â†’ Save).
- **Breadcrumb Navigation**: Clear back buttons, no deep nesting.

### Decisiones que Reducen Peso y Complejidad
- **No Frameworks**: Pure PHP/MySQL, no Laravel/Symfony overhead.
- **Lazy Loading**: Images and JS loaded only when needed.
- **Minified Assets**: Single CSS file <20KB, JS <30KB total.
- **No Heavy Libraries**: Vanilla JS, no jQuery/React/Vue.
- **Database Optimization**: Indexed queries, no complex joins.
- **Caching**: File-based cache for static data, no Redis dependency.

## 2. Roles Avanzados (Super-Admin Clave)

### Modelo de Permisos
- **Super Admin**: `manage_organizations`, `manage_stores`, `manage_users`, `manage_inventory`, `process_sales`, `view_reports`, `manage_settings`, `authorize_products`, `suspend_stores`, `edit_any_store`.
- **Organization Admin**: `manage_stores` (within org), `manage_users`, `manage_inventory`, `process_sales`, `view_reports`.
- **Store Manager**: `manage_inventory`, `process_sales`, `view_reports`, `manage_users` (store staff).
- **Cashier**: `process_sales`.
- **Customer**: `view_own_history`.

### Validaciones en Backend
- **Permission Checks**: Every action validates `hasPermission($user_id, $permission)` before execution.
- **Store Isolation**: Non-super users restricted to their store_id.
- **Input Validation**: Sanitize all inputs, prevent SQL injection with prepared statements.
- **CSRF Tokens**: For forms to prevent cross-site requests.

### PrevenciÃ³n de Abuso o Errores desde MÃ³vil
- **Rate Limiting**: Max 10 actions/min per user to prevent spam.
- **Audit Logging**: All super-admin actions logged with timestamp, IP, user_agent.
- **Session Timeout**: 2 hours inactivity, force reauth for critical actions.
- **Device Fingerprinting**: Log device info for anomaly detection.
- **Confirmation Dialogs**: Critical actions (suspend store) require confirmation.

## 3. UI TÃ¡ctil para Super-Admin (Celular)

### Componentes UI Esenciales
- **Dashboard Cards**: Large cards for pending approvals, incidents, quick stats.
- **Swipeable Lists**: Stores/products with swipe-to-approve/reject.
- **Floating Action Button (FAB)**: For quick actions like "Authorize All".
- **Modal Overlays**: For details/confirmations, full-screen on mobile.
- **Tabs**: Top tabs for "Pending", "Approved", "Suspended".
- **Search Bar**: Prominent, with voice input support.

### Gestos TÃ¡ctiles
- **Tap to View**: Details of store/product.
- **Swipe Right**: Approve (green indicator).
- **Swipe Left**: Reject/Suspend (red indicator).
- **Long Press**: Quick edit menu.
- **Pinch to Zoom**: For images/reports.
- **Pull to Refresh**: Update pending lists.

### QuÃ© Evitar para No Sobrecargar la App
- **No Infinite Scroll**: Paginated lists, max 20 items/page.
- **No Heavy Animations**: Simple transitions, no CSS transforms.
- **No Complex Forms**: Step-by-step wizards, auto-save drafts.
- **No Popups**: Use modals instead.
- **No Auto-Play Media**: Lazy load images/videos.
- **No Background Processes**: Sync only on user action.

## 4. Tablet como Terminal Principal

### Resoluciones Comunes
- **Android Tablets**: 1280x800 (10"), 1920x1200 (12"), 2560x1600 (13").
- **iPad**: 2048x1536 (9.7"), 2224x1668 (10.5").
- **Responsive Breakpoints**: Mobile <768px, Tablet 768-1024px, Desktop >1024px.

### Layout Responsive Real
- **Grid System**: 12-column CSS grid, fluid widths.
- **Flexible Images**: Max-width 100%, height auto.
- **Touch-Friendly Spacing**: 16px gutters, 24px margins.
- **Orientation Handling**: Portrait/landscape auto-adjust.

### Formularios Grandes y Claros
- **Large Inputs**: 48px height, 16px font, placeholder text.
- **Grouped Fields**: Logical sections with headings.
- **Validation Feedback**: Inline messages, color-coded (green/red).
- **Keyboard Optimization**: Numeric keypad for prices, auto-focus next field.

### Flujos Cortos (MÃ¡x. 3 Pasos)
- **Product Creation**: 1. Category Select, 2. Details Form, 3. Confirm.
- **Sale Process**: 1. Scan/Add Items, 2. Payment, 3. Receipt.
- **Admin Approval**: 1. Review List, 2. Swipe Action, 3. Confirm.

### Recomendaciones UX EspecÃ­ficas para Tablets Android
- **Navigation Drawer**: Left slide-out menu for sections.
- **Thumb Zone**: Place actions in bottom-right for one-hand use.
- **Haptic Feedback**: Vibrate on touch for confirmation.
- **Dark Mode**: Optional, battery-saving.
- **Offline Indicators**: Show sync status in header.
- **Accessibility**: High contrast, screen reader support.

## 5. AuditorÃ­a Tipo Bundle Visualizer (Muy Importante)

### Estrategias para Reducir Bundle Size
- **Minify CSS/JS**: Use tools like minify, target <50KB total.
- **Lazy Load JS**: Load scripts only for specific pages.
- **Inline Critical CSS**: Above-fold styles in <head>, rest deferred.
- **WebP Images**: Convert all to WebP, lazy load with IntersectionObserver.
- **No Unused Code**: Audit and remove dead JS/CSS.
- **Compress Assets**: Gzip/Brotli on server.

### MÃ©tricas a Observar
- **First Contentful Paint (FCP)**: <1.5s.
- **Largest Contentful Paint (LCP)**: <2.5s.
- **Total Blocking Time (TBT)**: <200ms.
- **Bundle Size**: <100KB gzipped.
- **Requests**: <20 per page.
- **Lighthouse Score**: >90.

### Errores Comunes a Evitar
- **Large Images**: No >500KB images, optimize to <50KB.
- **Unminified Code**: Always minify production assets.
- **Blocking JS**: Use defer/async, no render-blocking scripts.
- **Heavy Fonts**: Use system fonts, preload if custom.
- **No Caching**: Set proper cache headers.
- **Third-Party Scripts**: Minimize, load after main content.

## 6. Stack Frontend Liviano (Recomendado)

### HTML SemÃ¡ntico
- **Semantic Tags**: <header>, <nav>, <main>, <section>, <article>, <aside>, <footer>.
- **Accessibility**: ARIA labels, alt texts, proper heading hierarchy.
- **Clean Structure**: No div soup, meaningful class names.

### CSS Nativo o Utilitario MÃ­nimo
- **Custom CSS**: No Bootstrap/Tailwind, write utility classes as needed.
- **CSS Grid/Flexbox**: For layouts, no floats.
- **Variables**: CSS custom properties for themes.
- **Media Queries**: Mobile-first, tablet/desktop breakpoints.

### JS Vanilla o Micro-Libs
- **Vanilla JS**: DOM manipulation with querySelector, addEventListener.
- **Micro-Libs**: Tiny libraries like Axios for AJAX (if needed), <5KB.
- **Modular JS**: ES6 modules, loaded on demand.

### JustificaciÃ³n vs React/Vue
- **Performance**: No virtual DOM overhead, direct DOM updates.
- **Bundle Size**: React ~100KB+, Vue ~80KB+; this <30KB.
- **Simplicity**: No build tools, easier deployment on shared hosting.
- **Mobile Optimization**: Faster load on slow connections.
- **Maintenance**: Less dependencies, fewer security issues.

## 7. Autorizaciones y AuditorÃ­a Humana

### Modelo de Datos
- **Status Fields**: products.status = 'pending', stores.status = 'pending'.
- **Audit Table**: authorization_logs (id, user_id, action, target_type, target_id, old_value, new_value, timestamp).
- **Relationships**: Link to users for who authorized.

### Ejemplos de Flujo PHP
```php
// Approve product
if (hasPermission($user_id, 'authorize_products')) {
    $stmt = $pdo->prepare("UPDATE products SET status = 'approved' WHERE id = ?");
    $stmt->execute([$product_id]);
    logAuthorization($user_id, 'approve', 'product', $product_id, 'pending', 'approved');
}
```

### Logging
- **Who**: user_id from session.
- **When**: CURRENT_TIMESTAMP.
- **What**: Action (approve/reject), target (product/store), changes.

## 8. Offline Parcial (Plus Clave en Tablets)

### Cacheo de Vistas
- **Service Worker? No**: Too heavy, use browser cache with Cache-Control.
- **LocalStorage**: Cache static data like categories, expire after 24h.
- **IndexedDB**: For larger data like product lists, sync on reconnect.

### Reintentos de Acciones
- **Queue Actions**: Store failed requests in LocalStorage, retry on online.
- **Exponential Backoff**: Wait 1s, 2s, 4s... before retry.
- **User Feedback**: Show "Syncing..." indicator.

### PrevenciÃ³n de Duplicados
- **Unique IDs**: Client-generated UUIDs for transactions.
- **Idempotency**: Server checks for existing records before insert.
- **Optimistic UI**: Show action completed, revert on failure.

### Sin Convertirlo en PWA Pesada
- **No App Manifest**: No install prompt.
- **No Background Sync**: Manual sync only.
- **No Push Notifications**: Optional, not core.

## 9. Seguridad en Contexto MÃ³vil

### Sesiones Largas en Tablets
- **Timeout**: 8 hours active, 2 hours idle.
- **Regeneration**: New session ID on login, periodic refresh.
- **Device Binding**: Optional, tie session to device fingerprint.

### Super-Admin desde Celular
- **2FA**: SMS code for critical actions.
- **IP Whitelisting**: Allow only known IPs for super-admin.
- **Action Limits**: Max 50 approvals/day to prevent abuse.

### PÃ©rdida o Robo del Dispositivo
- **Remote Logout**: Super-admin can invalidate all sessions.
- **Biometric Lock**: Encourage device-level security.
- **Data Encryption**: Encrypt sensitive data in DB.

### ExpiraciÃ³n Inteligente
- **Activity-Based**: Extend on active use, shorten on suspicious activity.
- **Location Check**: Alert on login from new location.

### ReautenticaciÃ³n CrÃ­tica
- **Before Sensitive Actions**: Password prompt for suspend/edit.
- **Biometric**: If device supports, use fingerprint.

### Logs de Actividad
- **Table**: activity_logs (user_id, action, ip, user_agent, timestamp).
- **Retention**: 90 days, audit regularly.

## 10. MVP Enfocado a Tablet + Super-Admin MÃ³vil

### QuÃ© Entra
- User auth with roles.
- Store/product management with pending approval.
- Basic POS sales on tablets.
- Super-admin mobile panel for approvals.
- Offline product viewing.
- Audit logging.

### QuÃ© Queda Fuera
- Advanced reports/analytics.
- Multi-language.
- Third-party integrations (payments, etc.).
- Customer portal.
- Advanced inventory features.

### Tiempo Realista
- **Phase 1 (2 weeks)**: Auth, basic CRUD, DB setup.
- **Phase 2 (3 weeks)**: POS functionality, tablet UI.
- **Phase 3 (2 weeks)**: Super-admin panel, approvals, mobile optimization.
- **Total**: 7 weeks for MVP.

### Riesgos TÃ©cnicos
- **Performance**: Ensure queries optimized for tablets.
- **Security**: Mobile-specific vulnerabilities (session hijacking).
- **Offline**: Sync conflicts, data consistency.
- **Scalability**: Start small, plan for growth.

## 11. Esquema SQL Completo

The complete SQL schema is in `schema.sql`, including:
- Organizations, Stores, Users, Roles, Permissions
- Products, Inventory, Categories
- Sales, SaleItems, Customers, PaymentMethods, CashRegisters
- RequestLogs, ClientErrorLogs
- Default roles and permissions inserted

## 12. Estructura de Carpetas PHP

```
pure-php-design/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.php          # App config (timezones, etc.)
â”‚   â””â”€â”€ database.php        # DB credentials
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ AuthController.php  # Login/logout
â”‚   â”œâ”€â”€ StoreController.php # Store CRUD
â”‚   â”œâ”€â”€ ProductController.php # Product management
â”‚   â”œâ”€â”€ SaleController.php  # POS sales
â”‚   â””â”€â”€ AdminController.php # Super-admin approvals
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ User.php            # User model
â”‚   â”œâ”€â”€ Store.php           # Store model
â”‚   â”œâ”€â”€ Product.php         # Product model
â”‚   â””â”€â”€ Sale.php            # Sale model
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ login.php           # Login form
â”‚   â”œâ”€â”€ dashboard.php       # Main dashboard
â”‚   â”œâ”€â”€ super-admin.php     # Super-admin panel
â”‚   â”œâ”€â”€ stores.php          # Store list
â”‚   â”œâ”€â”€ products.php        # Product management
â”‚   â””â”€â”€ sales.php           # POS interface
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ Database.php        # PDO singleton
â”‚   â”œâ”€â”€ functions.php       # Helpers (auth, permissions)
â”‚   â””â”€â”€ session.php         # Session management
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.php           # Router entry point
â”‚   â”œâ”€â”€ .htaccess           # URL rewriting
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css       # Minified CSS <20KB
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js          # Vanilla JS <30KB
â””â”€â”€ schema.sql              # DB schema
```

## 13. Wireframe Textual del Panel Super-Admin

### Header (Fixed Top)
- Logo/Title: "Super Admin Panel"
- User Info: [Avatar] [Name] Logout
- Online Status: Green dot + "Online"

### Navigation Tabs (Top)
- [Pending Approvals] [Approved] [Suspended] [Incidents]

### Main Content Area (Scrollable)
#### Pending Approvals Tab
- Search Bar: [Input] ðŸ” (with voice icon)
- Filter Buttons: [All] [Stores] [Products] [Users]
- List of Items (Cards, max 10/page)
  - Card: [Swipeable]
    - Left: Thumbnail/Icon
    - Center: Name, Type, Submitted By, Date
    - Right: Status Badge "Pending"
    - Swipe Right: Green "Approve" overlay
    - Swipe Left: Red "Reject" overlay
- Pagination: [1] [2] [3] ... [Next]
- FAB (Bottom Right): + "Bulk Approve"

#### Store/Product Details Modal (Full Screen on Mobile)
- Header: [Back] Title [Edit]
- Image: Large WebP image
- Details: Name, Description, Price, Category, etc.
- Actions: [Approve] [Reject] [Edit] [Suspend]
- Audit Log: Timeline of changes

#### Incidents Tab
- List of Alerts: Store suspended, Product rejected, etc.
- Each: [Resolve] button

### Footer (Fixed Bottom, Tablet Only)
- Quick Actions: [Dashboard] [Approvals] [Reports] [Settings]

### Gestures
- Swipe card to approve/reject
- Long press for quick menu
- Pull down to refresh

## 14. Checklist Exacto para Pasar AuditorÃ­as

### Performance (Lighthouse >90)
- [ ] FCP <1.5s: Optimize server response, use CDN for assets
- [ ] LCP <2.5s: Lazy load images, inline critical CSS
- [ ] TBT <200ms: Defer non-critical JS, minimize main thread work
- [ ] CLS <0.1: Set dimensions for images/media
- [ ] Bundle Size <100KB gzipped: Minify CSS/JS, remove unused code
- [ ] Requests <20/page: Combine assets, lazy load
- [ ] No render-blocking resources: Use defer/async for scripts

### Accessibility (Lighthouse >90)
- [ ] Color contrast >4.5:1 for text
- [ ] Alt text for all images
- [ ] Keyboard navigation: Tab order logical
- [ ] ARIA labels for interactive elements
- [ ] Focus indicators visible
- [ ] Screen reader compatible

### Best Practices (Lighthouse >90)
- [ ] HTTPS enabled
- [ ] No console errors
- [ ] Proper cache headers (1 year for static, no-cache for dynamic)
- [ ] No deprecated APIs
- [ ] Valid HTML
- [ ] No excessive DOM size (<1500 elements)

### SEO (Lighthouse >90)
- [ ] Meta description, title
- [ ] Structured data (JSON-LD for products)
- [ ] Mobile-friendly (viewport meta)
- [ ] Fast loading for crawlers

### Bundle Analyzer Specific
- [ ] CSS: <20KB, no unused styles
- [ ] JS: <30KB, tree-shaken
- [ ] Images: WebP, <50KB each, lazy loaded
- [ ] Fonts: System fonts preferred, preload if custom
- [ ] Third-party: None or <5KB total

### Mobile-Specific
- [ ] Touch targets >44px
- [ ] No horizontal scroll
- [ ] Readable text without zoom
- [ ] Fast 3G load <3s

This design ensures a lightweight, mobile-first multi-store POS system that passes audits and scales efficiently.
